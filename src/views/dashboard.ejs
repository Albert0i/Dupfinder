<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>dupFinder Dashboard</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <script src="/assets/tailwind.js"></script>  
</head>
<body class="bg-gray-100 text-gray-900 h-screen flex items-center justify-center">

  <section class="w-full max-w-4xl h-[90vh] flex flex-col justify-between p-6 bg-white shadow-lg rounded-lg">

    <!-- ðŸŒ€ Header -->
    <header id="reloadHeader" class="text-center mb-4 hover:cursor-pointer" title="Click to refresh">
      <h1 class="text-4xl font-bold">
        ðŸŒ€ <span class="font-normal">dup</span><span class="font-extrabold text-gray-900">Finder</span>
      </h1>
      
      <p class="text-gray-900 italic mt-2">
        Some people create redundancy on purpose, while many others do so by accident.<br />
        Chances areâ€¦ you need to find your long lost twin brothers...
      </p>    
    </header>

    <!-- ðŸ“Š Main -->
    <main class="flex-grow flex flex-col justify-center hover:cursor-pointer"
      onclick="window.open('/duplicates', '_blank')">      

      <div class="grid grid-cols-2 gap-6 text-center">
        <div class="bg-blue-50 p-8 rounded-lg shadow">
          <h2 class="text-xl font-semibold mb-2">Files Scanned</h2>
          <p class="text-4xl font-bold text-blue-700"><%= totalFiles %></p>
        </div>

        <div class="bg-red-50 p-8 rounded-lg shadow">
          <h2 class="text-xl font-semibold mb-2">Suspicious Duplicates</h2>
          <p class="text-4xl font-bold text-red-700"><%= duplicateCount %></p>
        </div>
      </div>

    </main>

    <section class="flex-grow flex flex-col justify-center" >
      <div class="mt-6 text-center text-lg text-black">

        <p class="mt-1 flex items-center justify-center space-x-2">
          <span>Scanned folder:</span>
          <code class="bg-gray-100 px-2 py-1 rounded text-sm">
            <%= (scanFolder ? scanFolder.replace('\\\\', '\\').replace('//', '/') : '---') %>
          </code>
          <a href="/info" target="_blank"
             class="text-blue-600 hover:text-blue-800 transition"
             title="system information">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                 viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M13 16h-1v-4h-1m1-4h.01M12 20a8 8 0 100-16 8 8 0 000 16z" />
            </svg>
          </a>
        </p>

        <p class="mt-1">
          Scanned at: <%= (scanAt ? scanAt: '---') %>
        </p>

        <input type="checkbox" id="autoReloadToggle" />
        <label for="autoReloadToggle" class="text-sm text-gray-900">
          Reload every 5 seconds
        </label>
      </div>      
    </section>

    <!-- Copilot Credit -->
    <footer class="m-4 text-center text-sm text-gray-700">
      <p>
        Crafted with quiet guidance by 
        <a href="https://copilot.microsoft.com" target="_blank" class="text-blue-600 font-semibold hover:underline">
          Microsoft Copilot
        </a> â€” <br />your companion in code.
      </p>
    </footer>

  </section>

  <script type="text/javascript">
    const toggle = document.getElementById('autoReloadToggle');
    let reloadInterval = null;
  
    // Value passed from server
    const scanAt = <%- JSON.stringify(scanAt) %>;
  
    // Restore saved state
    const saved = localStorage.getItem('autoReloadEnabled');
    if (saved === 'true') {
      toggle.checked = true;
      startReload();
    }
  
    // Listen for changes
    toggle.addEventListener('change', () => {
      const enabled = toggle.checked;
      localStorage.setItem('autoReloadEnabled', enabled);
      if (enabled) {
        startReload();
      } else {
        stopReload();
      }
    });
  
    function startReload() {
      stopReload(); // clear any existing interval
      reloadInterval = setInterval(() => {
        // If scanAt is now defined, stop reloading
        if (scanAt !== null && scanAt !== undefined && scanAt !== '') {
          toggle.checked = false;
          localStorage.setItem('autoReloadEnabled', false);
          stopReload();
          console.log('ðŸ§˜ Scan complete â€” auto reload disabled.');
        } else {
          window.location.reload();
        }
      }, 5000);
    }
  
    function stopReload() {
      if (reloadInterval) {
        clearInterval(reloadInterval);
        reloadInterval = null;
        localStorage.removeItem('autoReloadEnabled');
      }
    }

    document.getElementById('reloadHeader').addEventListener('click', () => {
      location.reload();
    });

  </script>

</body>
</html>